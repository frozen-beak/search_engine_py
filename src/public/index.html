<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TurboZ</title>
    <link rel="icon" href="logo.png" type="image/x-icon" />

    <!-- Global Styles -->
    <style>
      /* ------------ Typefaces ------------ */

      @font-face {
        font-family: "JetBrainsMonoNF";
        src: url("./fonts/JetBrainsMonoNF-300.woff2") format("woff2");
        font-weight: 300;
        font-style: normal;
        font-display: swap;
      }

      @font-face {
        font-family: "JetBrainsMonoNF";
        src: url("./fonts/JetBrainsMonoNF-400.woff2") format("woff2");
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }

      @font-face {
        font-family: "JetBrainsMonoNF";
        src: url("./fonts/JetBrainsMonoNF-600.woff2") format("woff2");
        font-weight: 600;
        font-style: normal;
        font-display: swap;
      }

      /* ------------ Root Styles ------------ */

      :root {
        /* Typefaces */
        --jbMono-nf: "JetBrainsMonoNF", monospace;

        /* Available Font Weights */
        --font-light: 300;
        --font-regular: 400;
        --font-bold: 600;

        /* Colors (Default to DarkTheme) */
        --c-bg: #f8f9fa;
        --c-secBg: #e9ecef;
        --c-onBg: rgba(233, 236, 239, 0.24);
        --c-primary: #212529;
        --c-secondary: #495057;
        --c-tertiary: #6c757d;
        --c-accent: #42a0fd;

        /* Typography */
        --base-font-size: 1rem;
        --base-line-height-multiplier: 1.3;

        /* Font Sizes */
        --font-size12: calc(12 / 16 * 1rem);
        --font-size14: calc(14 / 16 * 1rem);
        --font-size16: calc(16 / 16 * 1rem);
        --font-size18: calc(18 / 16 * 1rem);
        --font-size20: calc(20 / 16 * 1rem);
        --font-size28: calc(28 / 16 * 1rem);

        /* Line Heights */
        --line-height12: calc(
          12 / 16 * var(--base-line-height-multiplier) * 1rem
        );
        --line-height14: calc(
          14 / 16 * var(--base-line-height-multiplier) * 1rem
        );
        --line-height16: calc(
          16 / 16 * var(--base-line-height-multiplier) * 1rem
        );
        --line-height18: calc(
          18 / 16 * var(--base-line-height-multiplier) * 1rem
        );
        --line-height20: calc(
          20 / 16 * var(--base-line-height-multiplier) * 1rem
        );
        --line-height28: calc(
          28 / 16 * var(--base-line-height-multiplier) * 1rem
        );

        /* Spacing */
        --base-space: 0.5rem;

        /* Radius */
        --base-radius: 0.5rem;
      }

      /* Applied to every element */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* ------------ Text Styles ------------ */

      .title1 {
        font-family: var(--jbMono-nf);
        font-size: var(--font-size28);
        font-weight: var(--font-bold);
        line-height: var(--line-height28);
      }

      .title2 {
        font-family: var(--jbMono-nf);
        font-size: var(--font-size14);
        font-weight: var(--font-regular);
        line-height: var(--line-height14);
      }

      .bText {
        font-family: var(--jbMono-nf);
        font-size: var(--font-size16);
        font-weight: var(--font-regular);
        line-height: var(--line-height16);
      }

      .body1 {
        font-family: var(--jbMono-nf);
        font-size: var(--font-size16);
        font-weight: var(--font-regular);
        line-height: var(--line-height16);
      }

      .body2 {
        font-family: var(--jbMono-nf);
        font-size: var(--font-size16);
        font-weight: var(--font-light);
        line-height: var(--line-height16);
      }

      .text1 {
        font-family: var(--jbMono-nf);
        font-size: var(--font-size14);
        font-weight: var(--font-regular);
        line-height: var(--line-height14);
      }

      .text2 {
        font-family: var(--jbMono-nf);
        font-size: var(--font-size12);
        font-weight: var(--font-regular);
        line-height: var(--line-height12);
      }

      /* ------------ Radius ------------ */

      .radius1 {
        border-radius: calc(0.5 * var(--base-radius));
      }

      .radius2 {
        border-radius: calc(1 * var(--base-radius));
      }

      .radius3 {
        border-radius: calc(2 * var(--base-radius));
      }

      .radius4 {
        border-radius: calc(3 * var(--base-radius));
      }

      /* ------------ Inputs ------------ */

      input[type="text"] {
        background-color: transparent;
        border: 0px;

        color: var(--c-primary);

        font-family: var(--jbMono-nf);
        font-size: var(--font-size16);
        line-height: var(--line-height16);
        font-weight: var(--font-regular);
      }

      input[type="text"]:focus {
        outline: 0px;
      }

      input[type="text"]::placeholder {
        color: var(--c-tertiary);

        font-size: var(--font-size16);
        line-height: var(--line-height16);
        font-weight: var(--font-regular);
      }

      /* ------------ Buttons ------------ */

      button {
        border: 0px;
        background-color: transparent;

        padding-left: calc(1.25 * var(--base-space));
        padding-right: calc(1.8 * var(--base-space));
        padding-top: calc(0.6 * var(--base-space));
        padding-bottom: calc(0.6 * var(--base-space));
      }

      button:hover {
        cursor: pointer;
        background-color: var(--c-primary);
        color: var(--c-bg);
      }

      /* ------------ Scrollbar ------------ */

      /* The scrollbar's width */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      /* The background of the scrollbar track */
      ::-webkit-scrollbar-track {
        background: var(--c-onBg);
        /* border-radius: 2px; */
      }

      /* The handle (thumb) of the scrollbar */
      ::-webkit-scrollbar-thumb {
        background: var(--c-secBg);
        border-radius: 2px;
      }

      /* The thumb on hover */
      ::-webkit-scrollbar-thumb:hover {
        background: var(--c-bg);
      }
    </style>
  </head>
  <body id="body">
    <header>
      <a href="https://github.com/frozen-beak/search_engine_py/" class="title1">
        &#xe709;
      </a>
    </header>
    <h1 class="title1 heading">
      Turbo <img src="./logo.png" alt="ZeroTab" width="24" height="24" />
    </h1>

    <div style="height: 12px"></div>
    <h2 class="title2">Your Awesome Car Search</h2>
    <div style="height: 24px"></div>

    <div id="search-div" class="search-div radius3">
      <input
        spellcheck="true"
        id="search-input"
        type="text"
        placeholder="Search, e.g. Porsche 911"
        autocomplete="off"
      />
      <button class="bText radius1" id="settings" onclick="search()">
        &#xf422;
      </button>
    </div>

    <div style="height: 28px"></div>

    <!-- Search results go here -->
  </body>

  <style>
    body {
      width: 100%;
      min-height: 90vh;
      display: flex;
      flex-flow: column nowrap;
      align-items: center;
      padding: calc(36 * var(--base-space)) 0px;

      background-color: var(--c-bg);

      position: relative;
    }

    header {
      position: absolute;
      width: 100%;
      padding: calc(1.5 * var(--base-space)) calc(3 * var(--base-space));

      top: 0;
      left: 0;

      display: flex;
      flex-flow: row nowrap;
      align-items: center;
      justify-content: flex-end;
    }

    header a {
      text-decoration: none;
      color: var(--c-primary);
    }

    .heading {
      width: 40%;

      display: flex;
      flex-flow: row nowrap;
      justify-content: center;
      align-items: center;
    }

    .heading img {
      width: calc(4 * var(--base-space));
      height: calc(4 * var(--base-space));
    }

    .search-div {
      background-color: var(--c-secBg);

      display: flex;
      flex-flow: row nowrap;
      align-items: center;

      gap: calc(1.5 * var(--base-space));
      padding: calc(1.25 * var(--base-space)) calc(1.5 * var(--base-space));

      width: 40%;
      max-height: 48%;
    }

    .search-div input {
      flex-grow: 1;
    }

    .result {
      background-color: var(--c-onBg);

      width: 40%;
      margin: calc(1.25 * var(--base-space)) 0px;
      padding: calc(1.25 * var(--base-space)) calc(1.5 * var(--base-space));

      display: flex;
      flex-flow: column nowrap;

      gap: calc(2 * var(--base-space));
    }

    .result .desc {
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .result .specs {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: calc(0.5 * var(--base-space));
    }

    .loader {
      background-color: var(--c-secBg);

      width: 40%;
      height: calc(20 * var(--base-space));
      margin: calc(1.25 * var(--base-space)) 0px;

      animation: flicker 1.5s infinite alternate;
    }

    @keyframes flicker {
      0% {
        background-color: var(--c-secBg);
      }
      100% {
        background-color: var(--c-onBg);
      }
    }
  </style>

  <script>
    let isSearching = false;

    const search = () => {
      const query = document.getElementById("search-input").value.trim();

      // Don't search if the input is empty
      if (!query) return;

      // debounce if already searching
      if (isSearching) return;

      // do not allow new searches
      isSearching = true;

      // Clear existing results
      clearResults();

      // show loading div
      showLoader();

      fetch(`/api/?query=${encodeURIComponent(query)}`)
        .then((res) => res.json())
        .then((results) => {
          // clear loading div
          deleteLoader();

          // Render new results
          renderResults(results);

          // allow for new search
          isSearching = false;
        })
        .catch((error) => {
          console.error("Error fetching results:", error);
        });
    };

    // delete all the rendered results
    const clearResults = () => {
      const results = document.querySelectorAll(".result");

      results?.forEach((result) => {
        result.remove();
      });
    };

    const showLoader = () => {
      const body = document.getElementById("body");

      for (let i = 0; i < 3; i++) {
        const loader = document.createElement("div");
        loader.className = "loader radius3";

        // append the loader in the [body]
        body.appendChild(loader);
      }
    };

    const deleteLoader = () => {
      const loaders = document.querySelectorAll(".loader");

      loaders?.forEach((loader) => {
        loader.remove();
      });
    };

    const renderResults = (results) => {
      const body = document.getElementById("body");

      results.forEach((result) => {
        const resultDiv = document.createElement("div");
        resultDiv.className = "result radius3";

        const title = document.createElement("a");
        title.href = result.link;
        title.className = "body1";
        title.textContent = result.name;

        const description = document.createElement("p");
        description.className = "text1 desc";
        description.textContent = result.desc;

        const specs = document.createElement("div");
        specs.className = "specs text2";

        const engine = document.createElement("p");
        engine.textContent = `engine: ${result.engine}`;

        const weight = document.createElement("p");
        weight.textContent = `weight: ${result.weight}`;

        const power = document.createElement("p");
        power.textContent = `power: ${result.power}`;

        const zeroToSixty = document.createElement("p");
        zeroToSixty.textContent = `0-62 mph: ${result.zero_to_sixty || "–"}`;

        const torque = document.createElement("p");
        torque.textContent = `torque: ${result.torque}`;

        const topSpeed = document.createElement("p");
        topSpeed.textContent = `top speed: ${result.top_speed || "–"}`;

        specs.append(engine, weight, power, zeroToSixty, torque, topSpeed);
        resultDiv.append(title, description, specs);

        // append the result in the [body]
        body.appendChild(resultDiv);
      });
    };

    // Event listener for Enter key in search input
    document
      .getElementById("search-input")
      .addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          search();
        }
      });
  </script>
</html>
